/**
 * Plugin: FileWizard
 * Author: Cres Jie Labasano
 * Email: cresjie@gmail.com
 * Github: http://github.com/cresjie
 * 
 */
 !function(t){function i(e,t,s){return this.$element=$(e),this.settings=$.extend({},i.DEFAULTS,t),this.headers=$.extend({},i.HEADERS,s),this.files=[],this.init(),this}function s(e,t){var s=[];if(arguments.length>1)for(var n in arguments)s.push(arguments[n]);var a=$(this),r=a.data("FileWizard");return r?r[e]?r[e].apply(r,s.splice(1,1)):void 0:(a.data("FileWizard",new i(a,e,t)),a)}var n=1,a=function(){};i.DEFAULTS={dragover:a,drop:a,dragenter:a,dragleave:a,rejected:function(e,t){switch(t){case"file_limit":alert("File exceeds file limit");break;case"file_type":alert("file type not allowed")}},fileAdded:a,fileRemoved:a,paramName:"files",url:"",method:"POST",clickable:!0,autoSend:!1,acceptedFiles:["jpg","jpeg","png","gif"],maxSize:5,multipleFiles:!0},i.HEADERS={},i.sizeToMB=function(e){return e/1024/1024};var r={addData:function(e,t){if((!this.settings.data||this.settings.data&&this.settings.data.constructor!=FormData)&&(this.settings.data=new FormData),e)if(e.constructor==Object)for(var i in e)this.settings.data.append(i,e[i]);else this.settings.data.append(e,t);return this},getFiles:function(){return this.files},resetFiles:function(){var e=this.files.slice();return this.files=[],this.input.value=null,this.settings.fileRemoved.call(this,e),this},addFiles:function(e){var t=this;limit=t.settings.multipleFiles?e.length:e.length?1:0;for(var s=0;s<limit;s++){if(i.sizeToMB(e[s].size)>t.settings.maxSize)return t.settings.rejected.call(this,e[s],"file_limit");var n=t.settings.acceptedFiles;if(n.length){var a=e[s].name.split("."),r=a[a.length-1].toLowerCase();if(n.indexOf(r)<0)return t.settings.rejected.call(this,e[s],"file_type")}t.settings.multipleFiles?t.files.push(e[s]):t.files[0]=e[s],t.settings.fileAdded.call(this,e[s])}return this},removeFile:function(e,t){t=t?t:1;var i=this.files.splice(e,t);return this.settings.fileRemoved.call(this,i),this},setOptions:function(e){return $.extend(this.settings,e),this},send:function(){this.addData.apply(this,arguments);for(var e in this.files){var t=this.files.length>1?this.settings.paramName+"[]":this.settings.paramName;this.addData(t,this.files[e])}return this.fileUploader=new FileUploader(this.settings,this.headers),this},abort:function(){return this.fileUploader&&this.fileUploader.abort(),this},init:function(){var t=this;return this.$element.each(function(i,s){$(s).on({dragenter:function(e){e.originalEvent.dataTransfer.types.indexOf("Files")>-1&&($(this).addClass("filewizard-dragenter"),t.settings.dragenter.call(this,e))},dragleave:function(e){$(this).removeClass("filewizard-dragenter"),t.settings.dragleave.call(this,e)},dragover:function(e){e.preventDefault(),t.settings.dragover.call(this,e)},drop:function(i){e=i.originalEvent,e.stopPropagation(),e.preventDefault(),$(this).removeClass("filewizard-dragenter"),e.dataTransfer.types.indexOf("Files")>-1?(files=e.dataTransfer.files,t.settings.drop.call(this,e,files),t.addFiles(files)):t.settings.rejected.call(this,null,"not_file",e)}})}),t.settings.clickable&&this.initForm(),this},initForm:function(){var e=this;e.input=document.createElement("input"),$(e.input).attr({type:"file","class":"filewizard-input filewizard-input-"+n}).css("display","none").on("change",function(t){e.addFiles(this.files)}),this.$element.on("click",function(t){t.preventDefault(),$(e.input).trigger("click")}),$("body").append(e.input),n++},getSettings:function(){return this.settings}};$.extend(i.prototype,r),$.fn.FileWizard=s,$.fn.FileWizard.Constructor=i,t.FileWizard=i}(window);