/**
 * Plugin: FileWizard
 * Author: Cres Jie Labasano
 * Email: cresjie@gmail.com
 * Github: http://github.com/cresjie
 * 
 */
 !function(e){e.FileUploader=function(e,t){var i={method:"get",data:{}},n={"Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"};if(!(this instanceof FileUploader))return new FileUploader(e,t);FileUploader.extend(i,e),FileUploader.extend(n,t);var s=new XMLHttpRequest;if("get"==i.method.toLowerCase()){var a=Object.keys(i.data).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i.data[e])}).join("&");s.open(i.method,i.url+"?"+a)}else s.open(i.method,i.url);for(var r in n)s.setRequestHeader(r,n[r]);return(!i.data||i.data&&i.data.constructor!=FormData)&&(i.data=FileUploader.toFormData(i.data)),s.onabort=i.abort,s.upload.onprogress=function(e){i.progress&&i.progress.call(this,e.loaded/e.total*100,e)},s.onload=function(e){var t=s.responseText;if(s.getResponseHeader("content-type")&&s.getResponseHeader("content-type").indexOf("application/json")>-1)try{t=JSON.parse(t)}catch(n){e=n,t="Invalid JSON response from server."}200==s.status?i.success&&i.success.call(this,t,e):i.error&&i.error.call(this,t,e),i.complete&&i.complete.call(this,t,e)},s.onerror=function(e,t){i.error.call(this,e,t)},s.send(i.data),this.abort=function(){return s.abort(),this},this.getRequest=function(){return s},this},FileUploader.toFormData=function(e,t){var i=new FormData;if(e&&(e.constructor==String&&i.append(e,t),e.constructor==Object))for(var n in e)i.append(n,e[n]);return i},FileUploader.extend=function(e,t){for(var i in t)e[i]=t[i];return e}}(window),function(t){function i(e,t,n){return this.$element=$(e),this.settings=$.extend({},i.DEFAULTS,t),this.headers=$.extend({},i.HEADERS,n),this.files=[],this.init(),this}function n(e,t){var n=[];if(arguments.length>1)for(var s in arguments)n.push(arguments[s]);var a=$(this),r=a.data("FileWizard");return r?r[e]?r[e].apply(r,n.splice(1,1)):void 0:(a.data("FileWizard",new i(a,e,t)),a)}var s=1,a=function(){};i.DEFAULTS={dragover:a,drop:a,dragenter:a,dragleave:a,rejected:function(e,t){switch(t){case"file_limit":alert("File exceeds file limit");break;case"file_type":alert("file type not allowed")}},fileAdded:a,fileRemoved:a,paramName:"files",url:"",method:"POST",clickable:!0,autoSend:!1,acceptedFiles:["jpg","jpeg","png","gif"],maxSize:5,multipleFiles:!0},i.HEADERS={},i.sizeToMB=function(e){return e/1024/1024};var r={addData:function(e,t){if((!this.settings.data||this.settings.data&&this.settings.data.constructor!=FormData)&&(this.settings.data=new FormData),e)if(e.constructor==Object)for(var i in e)this.settings.data.append(i,e[i]);else this.settings.data.append(e,t);return this},getFiles:function(){return this.files},resetFiles:function(){var e=this.files.slice();return this.files=[],this.input.value=null,this.settings.fileRemoved.call(this,e),this},addFiles:function(e){var t=this;limit=t.settings.multipleFiles?e.length:e.length?1:0;for(var n=0;n<limit;n++){if(i.sizeToMB(e[n].size)>t.settings.maxSize)return t.settings.rejected.call(this,e[n],"file_limit");var s=t.settings.acceptedFiles;if(s.length){var a=e[n].name.split(".")[1].toLowerCase();if(s.indexOf(a)<0)return t.settings.rejected.call(this,e[n],"file_type")}t.settings.multipleFiles?t.files.push(e[n]):t.files[0]=e[n],t.settings.fileAdded.call(this,e[n])}return this},removeFile:function(e,t){t=t?t:1;var i=this.files.splice(e,t);return this.settings.fileRemoved.call(this,i),this},setOptions:function(e){return $.extend(this.settings,e),this},send:function(){this.addData.apply(this,arguments);for(var e in this.files){var t=this.files.length>1?this.settings.paramName+"[]":this.settings.paramName;this.addData(t,this.files[e])}return this.fileUploader=new FileUploader(this.settings,this.headers),this},abort:function(){return this.fileUploader&&this.fileUploader.abort(),this},init:function(){var t=this;return this.$element.each(function(i,n){$(n).on({dragenter:function(e){e.originalEvent.dataTransfer.types.indexOf("Files")>-1&&($(this).addClass("filewizard-dragenter"),t.settings.dragenter.call(this,e))},dragleave:function(e){$(this).removeClass("filewizard-dragenter"),t.settings.dragleave.call(this,e)},dragover:function(e){e.preventDefault(),t.settings.dragover.call(this,e)},drop:function(i){e=i.originalEvent,e.stopPropagation(),e.preventDefault(),$(this).removeClass("filewizard-dragenter"),e.dataTransfer.types.indexOf("Files")>-1?(files=e.dataTransfer.files,t.settings.drop.call(this,e,files),t.addFiles(files)):t.settings.rejected.call(this,null,"not_file",e)}})}),t.settings.clickable&&this.initForm(),this},initForm:function(){var e=this;e.input=document.createElement("input"),$(e.input).attr({type:"file","class":"filewizard-input filewizard-input-"+s}).css("display","none").on("change",function(t){e.addFiles(this.files)}),this.$element.on("click",function(t){t.preventDefault(),$(e.input).trigger("click")}),$("body").append(e.input),s++},getSettings:function(){return this.settings}};$.extend(i.prototype,r),$.fn.FileWizard=n,$.fn.FileWizard.Constructor=i,t.FileWizard=i}(window);