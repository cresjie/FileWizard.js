/**
 * Plugin: FileWizard
 * Version: 1.0.3
 * Author: Cres Jie Labasano
 * Email: cresjie@gmail.com
 * Github: http://github.com/cresjie
 * 
 */!function(e){e.FileUploader=function(e,t){var i=function(){},s={method:"get",error:i,complete:i,success:i,progress:i,data:{}},n={"Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"};if(!(this instanceof FileUploader))return new FileUploader(e,t);FileUploader.extend(s,e),FileUploader.extend(n,t);var a=new XMLHttpRequest;if("get"==s.method.toLowerCase()){var r=Object.keys(s.data).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(s.data[e])}).join("&");a.open(s.method,s.url+"?"+r,!0)}else a.open(s.method,s.url,!0);for(var l in n)a.setRequestHeader(l,n[l]);return(!s.data||s.data&&s.data.constructor!=FormData)&&(s.data=FileUploader.toFormData(s.data)),a.onabort=s.abort,a.upload.onprogress=function(e){s.progress.call(this,e.loaded/e.total*100,e)},a.onreadystatechange=function(e){if(4===a.readyState){var t=a.responseText;if(a.getResponseHeader("content-type")&&a.getResponseHeader("content-type").indexOf("application/json")>-1)try{t=JSON.parse(t)}catch(i){e=i,t="Invalid JSON response from server."}200==a.status?s.success.call(this,t,e):s.error.call(this,t,e),s.complete.call(this,t,e)}},a.onerror=function(e,t){s.error.call(this,e,t)},a.send(s.data),this.abort=function(){return a.abort(),this},this.getRequest=function(){return a},this},FileUploader.toFormData=function(e,t){var i=new FormData;if(e&&(e.constructor==String&&i.append(e,t),e.constructor==Object))for(var s in e)i.append(s,e[s]);return i},FileUploader.extend=function(e,t){for(var i in t)e[i]=t[i];return e}}(window),function(t){function i(e,t,s){return this.$element=$(e),this.settings=$.extend({},i.DEFAULTS,t),this.headers=$.extend({},i.HEADERS,s),this.files=[],this.queue=[],this.init(),this}function s(e,t){var s=[];if(arguments.length>1)for(var n in arguments)s.push(arguments[n]);var a=$(this),r=a.data("FileWizard");return r?r[e]?r[e].apply(r,s.splice(1,1)):void 0:(a.data("FileWizard",new i(a,e,t)),a)}var n=1,a=function(){};i.DEFAULTS={dragover:a,drop:a,dragenter:a,dragleave:a,rejected:function(e,t){switch(t){case"file_limit":alert("File exceeds file limit");break;case"file_type":alert("file type not allowed")}},beforeSubmit:a,complete:a,success:a,fileAdded:a,filesAdded:a,fileRemoved:a,paramName:"files",url:"",method:"POST",parallel_upload:!0,parallel_files:3,clickable:!0,draggable:!0,autoSend:!1,acceptedFiles:["jpg","jpeg","png","gif"],maxSize:5,multipleFiles:!0},i.HEADERS={},i.sizeToMB=function(e){return e/1024/1024};var r={addData:function(e,t){if((!this.settings.data||this.settings.data&&this.settings.data.constructor!=FormData)&&(this.settings.data=new FormData),e)if(e.constructor==Object)for(var i in e)this.settings.data.append(i,e[i]);else this.settings.data.append(e,t);return this},getFiles:function(){return this.files},resetFiles:function(){var e=this.files.slice();return this.files=[],this.input.value=null,this.settings.fileRemoved.call(this,e),this},addFiles:function(e){var t=this;limit=t.settings.multipleFiles?e.length:e.length?1:0,addedFiles=[];for(var s=0;s<limit;s++){if(i.sizeToMB(e[s].size)>t.settings.maxSize)return t.settings.rejected.call(this,e[s],"file_limit");var n=t.settings.acceptedFiles;if(n.length){var a=e[s].name.split("."),r=a[a.length-1].toLowerCase();if(n.indexOf(r)<0)return t.settings.rejected.call(this,e[s],"file_type")}t.settings.multipleFiles?t.files.push(e[s]):t.files[0]=e[s],addedFiles.push(e[s]),t.settings.fileAdded.call(this,e[s])}return t.settings.filesAdded.call(this,addedFiles),this},removeFile:function(e,t){t=t?t:1;var i=this.files.splice(e,t);return this.settings.fileRemoved.call(this,i),this},setOptions:function(e){return $.extend(this.settings,e),this},send:function(){this.addData.apply(this,arguments);var e=this,t=e.files,i=e.settings.progress;if(successFn=e.settings.success,completeFn=e.settings.complete,errorFn=e.settings.error,e.settings.parallel_upload)for(var s=function(){if(t.length){var n=$.extend({},e.settings),a=t.shift(),l=null;n.data.append(r,a),n.complete=function(t,i){completeFn.call(e,t,i,a),e.removeQueue(l),s()},n.success=function(i,s){successFn.call(e,i,s,a);var n=t.indexOf(a);n>-1&&t.slice(n,1)},n.error=function(e,t){errorFn.call(this,e,t,a)},n.progress=function(t,s){i.call(this,t,s,a,e,l)},e.settings.beforeSubmit.call(e,n,a),l=new FileUploader(n,e.headers),e.addQueue(l)}},n=e.settings.parallel_files>this.queue.length?e.settings.parallel_files-this.queue.length:0,a=0;n>a;a++)s();else{for(var a in t){var r=t.length>1?l.paramName+"[]":l.paramName;e.addData(r,t[a])}var l=$.extend({},e.settings),o=null;l.complete=function(t,i){completeFn.call(e,t,i),e.removeQueue(o)},l.success=function(e,i){successFn.call(e,i),t.splice(0,t.length)},l.beforeSubmit.call(e,l,t),o=new FileUploader(e.settings,e.headers)}return this},abort:function(e){e=e?e:0;var t=this.queue[0];return t&&(t.abort(),this.queue.splice(e,1)),this},abortAll:function(){return this.queue.forEach(function(e){e.abort()}),this.queue=[],this},addQueue:function(e){return this.queue.push(e),this},removeQueue:function(e){var t=this.queue.indexOf(e);return t>-1&&this.queue.splice(t,1),this},init:function(){var t=this;return this.$element.each(function(i,s){t.settings.draggable&&$(s).on({dragenter:function(e){e.originalEvent.dataTransfer.types.indexOf("Files")>-1&&($(this).addClass("filewizard-dragenter"),t.settings.dragenter.call(this,e))},dragleave:function(e){$(this).removeClass("filewizard-dragenter filewizard-dragover"),t.settings.dragleave.call(this,e)},dragover:function(e){e.preventDefault(),$(this).addClass("filewizard-dragover"),t.settings.dragover.call(this,e)},drop:function(i){e=i.originalEvent,e.stopPropagation(),e.preventDefault(),$(this).removeClass("filewizard-dragenter"),e.dataTransfer.types.indexOf("Files")>-1?(files=e.dataTransfer.files,t.settings.drop.call(this,e,files),t.addFiles(files)):t.settings.rejected.call(this,null,"not_file",e),this.value=""}})}),t.settings.clickable&&this.initForm(),this},initForm:function(){var e=this;e.input=document.createElement("input"),$(e.input).attr({type:"file",multiple:e.settings.multipleFiles,"class":"filewizard-input filewizard-input-"+n}).css("display","none").on("change",function(t){e.addFiles(this.files),this.value=""}),this.$element.on("click",function(t){t.preventDefault(),$(e.input).trigger("click")}),$("body").append(e.input),n++},getOptions:function(){return this.settings}};$.extend(i.prototype,r),$.fn.FileWizard=s,$.fn.FileWizard.Constructor=i,t.FileWizard=i}(window);